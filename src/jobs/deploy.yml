description: |
  Simple job to sync a Linear release with your deployment.
  By default, this job will checkout your code and sync a release with Linear
  by scanning commits for Linear issue identifiers.
  
  This job is ideal for continuous deployment workflows where you want to
  automatically track releases in Linear without manual configuration.

executor:
  name: default

parameters:
  access_key:
    type: env_var_name
    default: LINEAR_ACCESS_KEY
    description: Environment variable name containing Linear pipeline access key
  command:
    type: enum
    enum: ["sync", "complete", "update"]
    default: sync
    description: |
      Command to run:
      - sync: Create or update a release with commits
      - complete: Mark a release as complete
      - update: Update release stage (e.g., staging, production)
  name:
    type: string
    default: ""
    description: |
      Custom release name (only used with sync command).
      Example: "Production Deploy - v1.2.3"
      If not provided, Linear will generate a name based on the date.
  version:
    type: string
    default: ""
    description: |
      Release version identifier.
      Example: "v1.2.3" or "${CIRCLE_SHA1:0:7}"
      If not provided, Linear will use the current timestamp.
  stage:
    type: string
    default: ""
    description: |
      Deployment stage (required for update command).
      Examples: "staging", "production", "development"
  include_paths:
    type: string
    default: ""
    description: |
      Filter commits by file paths for monorepo support.
      Comma-separated glob patterns.
      Example: "packages/api/**,packages/shared/**"
  cli_version:
    type: string
    default: "latest"
    description: |
      Linear Release CLI version to install.
      Use "latest" for most recent version or specific tag like "v0.2.0"

steps:
  - checkout
  - release:
      access_key: << parameters.access_key >>
      command: << parameters.command >>
      name: << parameters.name >>
      version: << parameters.version >>
      stage: << parameters.stage >>
      include_paths: << parameters.include_paths >>
      cli_version: << parameters.cli_version >>

executors:
  default:
    docker:
      - image: cimg/base:stable
